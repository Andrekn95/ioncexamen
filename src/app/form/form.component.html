<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button>
        <ion-icon slot="icon-only" name="compass-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Kuska Ñan</ion-title>
    <ion-buttons slot="end">
        <ion-icon slot="icon-only" name="log-out-outline"></ion-icon>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-toolbar color="light">
    <ion-segment value="default">
      <ion-segment-button value="donde" routerLink="/donde-ir">
        <ion-icon name="location-outline"></ion-icon>
        <ion-label>Registra tu viaje</ion-label>
      </ion-segment-button>
        <ion-icon name="log-out-outline"></ion-icon>
            <ion-button 
              type="submit"
              expand="block"
              color="primary"
              (click)="cerrarSesion()">
              Cerrar sesión
            </ion-button>
    </ion-segment>
  </ion-toolbar>

  <ion-content class="form-content">
    <div class="ion-padding">
      <ion-card class="form-card">
        <ion-card-header>
          <ion-card-title class="ion-text-center">Registro</ion-card-title>
        </ion-card-header>
        
        <ion-card-content>
          <form [formGroup]="formRegister" (ngSubmit)="onSubmit()">
            <ion-item>
              <ion-label position="floating">Nombre comercial</ion-label>
              <ion-input type="text" formControlName="nombreComercial" placeholder="Nombre del establecimiento"></ion-input>
            </ion-item>
            @if (nombreComercial?.touched || nombreComercial?.dirty) {
              @if (nombreComercial?.errors?.['required']) {
                <ion-text color="danger"><p>El nombre comercial es obligatorio.</p></ion-text>
              }
              @if (nombreComercial?.errors?.['minlength']) {
                <ion-text color="danger"><p>El nombre debe tener al menos 2 caracteres.</p></ion-text>
              }
            }

            <ion-item>
              <ion-label>Tipo</ion-label>
              <ion-select interface="popover" formControlName="tipo">
                <ion-select-option value="hotel">Hotel</ion-select-option>
                <ion-select-option value="motel">Motel</ion-select-option>
                <ion-select-option value="cabaña">Cabaña</ion-select-option>
              </ion-select>
            </ion-item>
            @if (tipo?.touched || tipo?.dirty) {
              @if (tipo?.errors?.['required']) {
                <ion-text color="danger"><p>Debe seleccionar un tipo (hotel, motel o cabaña).</p></ion-text>
              }
              @if (tipo?.errors?.['pattern']) {
                <ion-text color="danger"><p>Tipo no válido.</p></ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Dirección</ion-label>
              <ion-textarea
                formControlName="direccion"
                placeholder="Calle 123, Sector"
                maxlength="100"
                (ionInput)="contarCaracteres()"
                rows="3">
              </ion-textarea>
            </ion-item>

            <ion-text color="medium">
              <p>{{ caracteresDireccion }}/100 caracteres</p>
            </ion-text>

            @if (direccion?.touched || direccion?.dirty) {
              @if (direccion?.errors?.['required']) {
                <ion-text color="danger"><p>La dirección es obligatoria.</p></ion-text>
              }
              @if (direccion?.errors?.['pattern']) {
                <ion-text color="danger"><p>Solo se permiten letras, números y caracteres como #, -, .</p></ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Teléfono</ion-label>
              <ion-input type="tel" maxlength="9" formControlName="fijo" placeholder="0XXXXXXXX"></ion-input>
            </ion-item>
            @if (fijo?.touched || fijo?.dirty) {
              @if (fijo?.errors?.['pattern']) {
                <ion-text color="danger"><p>El teléfono debe comenzar con 0 y tener un código de provincia válido.</p></ion-text>
              }
              @if (fijo?.errors?.['minlength']) {
                <ion-text color="danger"><p>El teléfono debe tener 9 caracteres.</p></ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Celular</ion-label>
              <ion-input 
                type="tel"
                formControlName="contacto"
                inputmode="numeric"
                maxlength="10"
                placeholder="Ej: 0998765432">
              </ion-input>
            </ion-item>
            @if (contacto?.touched || contacto?.dirty) {
              @if (contacto?.errors?.['pattern']) {
                <ion-text color="danger"><p>El teléfono debe tener 10 dígitos y comenzar con 09.</p></ion-text>
              }
              @if (contacto?.errors?.['required']) {
                <ion-text color="danger"><p>El celular es requerido</p></ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Correo electrónico</ion-label>
              <ion-input type="email" formControlName="email" placeholder="ejemplo@dominio.com"></ion-input>
            </ion-item>
            @if (email?.touched || email?.dirty) {
              @if (email?.errors?.['required']) {
                <ion-text color="danger"><p>El correo es obligatorio.</p></ion-text>
              }
              @if (email?.errors?.['email']) {
                <ion-text color="danger"><p>Debe ingresar un correo válido.</p></ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Provincia</ion-label>
              <ion-input type="text" formControlName="ubicacion" placeholder="Provincia"></ion-input>
            </ion-item>
            @if (ubicacion?.touched || ubicacion?.dirty) {
              @if (ubicacion?.errors?.['required']) {
                <ion-text color="danger"><p>La provincia es obligatoria.</p></ion-text>
              }
              @if (ubicacion?.errors?.['provinciaInvalida']) {
                <ion-text color="danger">
                  <p>Seleccione una provincia válida.</p>
                </ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Descripción</ion-label>
              <ion-textarea
                formControlName="descripcion"
                placeholder="Describe tu establecimiento"
                maxlength="200"
                (ionInput)="contarCaracteres()"
                rows="3">
              </ion-textarea>
            </ion-item>

            <ion-text color="medium">
              <p>{{ caracteresDescripcion }}/200 caracteres</p>
            </ion-text>

            @if (descripcion?.touched || descripcion?.dirty) {
              @if (descripcion?.errors?.['required']) {
                <ion-text color="danger"><p>La descripción es obligatoria.</p></ion-text>
              }
              @if (descripcion?.errors?.['minlength']) {
                <ion-text color="danger"><p>Escribe una breve descripción.</p></ion-text>
              }
              @if (descripcion?.errors?.['pattern']) {
                <ion-text color="danger"><p>Solo se permiten letras y números.</p></ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Web (URL)</ion-label>
              <ion-input type="url" formControlName="web" placeholder="https://ejemplo.com"></ion-input>
            </ion-item>
            @if (web?.touched || web?.dirty) {
              @if (web?.errors?.['required']) {
                <ion-text color="danger"><p>La web es obligatoria.</p></ion-text>
              }
              @if (web?.errors?.['pattern']) {
                <ion-text color="danger"><p>Debe ingresar una URL válida.</p></ion-text>
              }
            }

            <ion-item>
              <ion-label position="floating">Habitaciones</ion-label>
              <ion-input type="number" formControlName="habitaciones" placeholder="Número de habitaciones"></ion-input>
            </ion-item>
            @if (habitaciones?.touched || habitaciones?.dirty) {
              @if (habitaciones?.errors?.['required']) {
                <ion-text color="danger"><p>Debe indicar el número de habitaciones.</p></ion-text>
              }
              @if (habitaciones?.errors?.['min']) {
                <ion-text color="danger"><p>Las habitaciones deben ser un número entero mayor a 0.</p></ion-text>
              }
              @if (habitaciones?.errors?.['pattern']) {
                <ion-text color="danger"><p>El máximo permitido es 9999 habitaciones.</p></ion-text>
              }
            }

            <ion-button
              expand="block"
              type="submit"
              [disabled]="formRegister.invalid"
            >
              Registrar
            </ion-button>
          </form>
        </ion-card-content>
      </ion-card>
    </div>
  </ion-content>
</ion-content>